{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Peppol Git Per Country","text":"<p>PEPPOL Per Country is a Python-based tool that synchronizes PEPPOL business directory exports by country. It downloads the massive XML export from <code>directory.peppol.eu</code>, processes it using streaming XML parsing, and splits business cards into country-specific files stored in git.</p>"},{"location":"#core-script","title":"Core Script","text":"<ul> <li>peppol_sync.py</li> <li>Python 3.x with <code>lxml</code> for XML processing</li> <li>GitHub Actions for daily automated sync</li> <li>Documentation : MkDocs with Material theme (using pforret/mkdox )</li> </ul>"},{"location":"#sparse-checkout","title":"Sparse Checkout","text":"<p>You can 'subscribe' to only the .xml files for 1 specific country (so not the full 2+GB of extract files) , using git sparse-checkout.</p>"},{"location":"documentation/","title":"mkdox documentation","text":"<p>Uses MkDocs with Material theme. Configuration in <code>mkdocs.yml</code>:</p> <ul> <li>Main docs in <code>docs/</code> directory</li> <li>Publish to <code>site/</code> directory</li> <li>Documentation is deployed to GitHub Pages via the static workflow</li> <li><code>README.md</code> is a symlink to <code>docs/index.md</code></li> </ul> <p>Published to peppoller.github.io/peppol_per_country</p>"},{"location":"github/","title":"GitHub action","text":""},{"location":"github/#daily-sync-workflow","title":"Daily Sync Workflow","text":"<ul> <li>via <code>.github/workflows/daily.yml</code></li> <li>Runs at 09:15 UTC daily</li> <li>Executes <code>python3 peppol_sync.py sync -V</code></li> <li>Commits and pushes changes to <code>extracts/</code> automatically</li> <li>Creates <code>extracts/git_diff.txt</code> with change summary</li> <li>takes +- 5 minutes</li> </ul>"},{"location":"github/#pages-deployment","title":"Pages Deployment","text":"<ul> <li>via <code>.github/workflows/static.yml</code></li> <li>Deploys <code>site/</code> directory to GitHub Pages</li> <li>Triggered on push to main branch</li> </ul>"},{"location":"github/#github-action-testing","title":"GitHub action testing","text":"<pre><code># uses https://github.com/nektos/act\n# on MacOS: brew install act\n\ntest_gh_action.sh\n</code></pre>"},{"location":"peppol_sync/","title":"peppol_sync.py","text":""},{"location":"peppol_sync/#overview","title":"Overview","text":"<p>The <code>peppol_sync.py</code> script is a command-line tool designed to synchronize business card data from the PEPPOL directory. It downloads a large XML file, splits it into smaller, more manageable XML files organized by country, and stores them in the <code>extracts/</code> directory.</p>"},{"location":"peppol_sync/#command-line-usage","title":"Command-line Usage","text":"<pre><code>usage: peppol_sync.py [-h] [-V] [-F] [-C] [-K] [-T TMP] [-M MAX] {sync,check,download,huge}\n\nSynchronize PEPPOL export into git-managed files\n\npositional arguments:\n  {sync,check,download,huge}\n                        Action to perform\n\noptions:\n  -h, --help            show this help message and exit\n  -V, --verbose         Enable verbose output\n  -F, --force           Force re-download of XML file even if it exists\n  -C, --nocleanup       Do not delete existing XML files in extracts/ before starting (default: delete)\n  -K, --keep-tmp        Keep temporary files after processing (default: delete)\n  -T, --tmp TMP         Temporary directory (default: tmp)\n  -M, --max MAX         Maximum number of bytes per output file (default: 1000000)\n</code></pre>"},{"location":"peppol_sync/#actions","title":"Actions","text":"<p>The first argument to the script must be one of the following actions:</p> <ul> <li><code>sync</code>: This is the main action. It performs the entire synchronization process, which includes downloading the XML file (if necessary) and splitting it into country-specific files.</li> <li><code>check</code>: This action checks the configuration and prints the temporary and extracts directories.</li> <li><code>download</code>: This action only downloads the PEPPOL business card XML file and saves it to the temporary directory.</li> <li><code>huge</code>: This action lists the largest XML files found in the <code>extracts/</code> directory.</li> </ul>"},{"location":"peppol_sync/#options","title":"Options","text":"<ul> <li><code>-h</code>, <code>--help</code>: Shows the help message and exits.</li> <li><code>-V</code>, <code>--verbose</code>: Enables verbose output, providing more detailed information about the script's execution.</li> <li><code>-F</code>, <code>--force</code>: Forces the script to re-download the main XML file, even if a local copy already exists.</li> <li><code>-C</code>, <code>--nocleanup</code>: By default, the script deletes all existing XML files in the <code>extracts/</code> directory before starting a new sync. This flag prevents the cleanup, preserving the existing files.</li> <li><code>-K</code>, <code>--keep-tmp</code>: Prevents the script from deleting temporary files (like the downloaded XML) after processing is complete.</li> <li><code>-T</code>, <code>--tmp TMP</code>: Specifies the temporary directory to use for downloading files. Defaults to <code>tmp</code>.</li> <li><code>-M</code>, <code>--max MAX</code>: Sets the maximum size in bytes for each output XML file. When a file exceeds this size, a new one is created. Defaults to 2000000 (2MB).</li> </ul>"},{"location":"peppol_sync/#functionality","title":"Functionality","text":"<p>The <code>PeppolSync</code> class handles the entire workflow:</p> <ol> <li> <p>Download Phase (<code>download_xml()</code> at line 70)</p> <ul> <li>Streams XML from <code>https://directory.peppol.eu/export/businesscards</code></li> <li>Saves to <code>tmp/directory-export-business-cards.xml</code></li> <li>Shows progress every 100MB</li> <li>Skips download if file exists (override with <code>-F</code>)</li> </ul> </li> <li> <p>Processing Phase (<code>process_xml()</code> at line 153)</p> <ul> <li>Uses text-based chunking (1MB chunks) for memory efficiency</li> <li>Parses business cards with <code>lxml.etree</code> for fast XML handling</li> <li>Extracts country code from <code>&lt;entity countrycode=\"XX\"&gt;</code></li> <li>Extracts registration date from <code>&lt;regdate&gt;</code> for statistics</li> <li>Writes pretty-printed XML to country directories</li> </ul> </li> <li> <p>File Splitting Logic (lines 228-250)</p> <ul> <li>Splits files when they exceed <code>max_bytes</code> (default: 2MB)</li> <li>Sequential naming: <code>business-cards.000001.xml</code>, <code>business-cards.000002.xml</code>, etc.</li> <li>Each country has its own directory: <code>extracts/BE/</code>, <code>extracts/NO/</code>, etc.</li> <li>Automatically creates header and footer tags for valid XML</li> </ul> </li> <li> <p>Report Generation (<code>generate_report()</code> at line 269)</p> <ul> <li>Creates <code>extracts/report.md</code> with country statistics</li> <li>Shows file count, card count, and size per country</li> </ul> </li> </ol>"},{"location":"peppol_sync/#running-the-sync-tool","title":"Running the sync tool","text":"<pre><code># Full sync: download + process XML (recommended for first run)\npython3 peppol_sync.py sync\n\n# Force re-download even if file exists\npython3 peppol_sync.py sync -F\n\n# Keep temporary files for debugging\npython3 peppol_sync.py sync -K\n\n# Don't delete existing extracts before processing\npython3 peppol_sync.py sync -C\n\n# Verbose output\npython3 peppol_sync.py sync -V\n</code></pre>"},{"location":"peppol_sync/#utility-commands","title":"Utility commands","text":"<pre><code># Download XML only (no processing)\npython3 peppol_sync.py download\n\n# Check configuration\npython3 peppol_sync.py check\n\n# Show largest output files\npython3 peppol_sync.py huge -n 20\n\n# Custom max file size (default: 2MB)\npython3 peppol_sync.py sync -M 1000000\n</code></pre>"},{"location":"peppol_sync/#dependencies","title":"Dependencies","text":"<pre><code># Install required Python package\npip install lxml\n</code></pre>"},{"location":"peppol_sync/#key-implementation-details","title":"Key Implementation Details","text":""},{"location":"peppol_sync/#memory-efficient-xml-processing","title":"Memory-Efficient XML Processing","text":"<p>The script processes multi-GB XML files without loading everything into memory:</p> <ul> <li>Reads in 1MB text chunks</li> <li>Splits on <code>&lt;/businesscard&gt;</code> delimiter</li> <li>Parses individual cards with lxml</li> <li>Uses streaming writes to output files</li> </ul>"},{"location":"peppol_sync/#country-code-extraction","title":"Country Code Extraction","text":"<p>Located in <code>extract_country_from_etree()</code> (line 130): <pre><code>entity = element.find(\".//entity\")\nif entity is not None:\n    return entity.get(\"countrycode\")\n</code></pre></p>"},{"location":"peppol_sync/#file-rotation","title":"File Rotation","text":"<p>When a country file exceeds <code>max_bytes</code>:</p> <ol> <li>Writes <code>&lt;/root&gt;</code> footer to close current file</li> <li>Increments sequence number in <code>self.file_stats[country]['sequence']</code></li> <li>Opens new file with updated sequence</li> <li>Writes XML header to new file</li> </ol>"},{"location":"peppol_sync/#cleanup-behavior","title":"Cleanup Behavior","text":"<ul> <li>Temporary files (<code>tmp/</code>): Deleted after processing by default (keep with <code>-K</code>)</li> <li>Extract files (<code>extracts/**/*.xml</code>): Deleted before each sync by default (preserve with <code>-C</code>)</li> <li>Log file (<code>extracts/peppol_sync.log</code>): Overwritten on each run</li> </ul>"},{"location":"sparse/","title":"Git Sparse Checkout","text":"<p>If you are only interested in the data for a specific country, you can use Git's <code>sparse-checkout</code> feature to download only the files for that country. This can save a significant amount of disk space and time.</p> <p>Here is how you can do a sparse checkout for just the data for Norway (<code>NO</code>).</p>"},{"location":"sparse/#step-by-step-guide","title":"Step-by-step guide","text":"<ol> <li> <p>Clone the repository without checking out any files:</p> <p>This special clone command creates the <code>.git</code> directory with all the repository history but doesn't pull the actual files yet.</p> <pre><code>git clone --filter=blob:none --no-checkout https://github.com/peppol-io/peppol-sync.git\ncd peppol-sync\n</code></pre> </li> <li> <p>Enable sparse checkout and define the directory you want:</p> <p>This command tells Git that you only want to have the files in the <code>extracts/NO/</code> directory.</p> <pre><code>git sparse-checkout set extracts/NO/\n</code></pre> </li> <li> <p>Pull the files:</p> <p>Now, Git will pull only the files that match the path you specified.</p> <pre><code>git checkout\n</code></pre> </li> </ol> <p>After these steps, your <code>extracts/</code> directory will contain only the <code>NO</code> subdirectory.</p>"},{"location":"sparse/#adding-more-directories","title":"Adding more directories","text":"<p>If you want to add more directories later, you can use the <code>add</code> command:</p> <pre><code>git sparse-checkout add extracts/SE/\ngit checkout\n</code></pre>"},{"location":"sparse/#reverting-to-a-full-checkout","title":"Reverting to a full checkout","text":"<p>If you want to disable sparse checkout and download all the files in the repository, you can use the <code>disable</code> command:</p> <pre><code>git sparse-checkout disable\ngit checkout\n</code></pre>"}]}