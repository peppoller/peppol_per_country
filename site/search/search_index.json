{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Home","text":""},{"location":"#peppol-per-country","title":"Peppol Per Country","text":"<p>Peppol Per Country is a GitHub repository where the Peppol Business Cards export from directory.peppol.eu (a single XML file of more than 2GB), is split into manageable 2MB XML files per country, and this is synced on a daily basis.</p> <p>It allows for</p> <ul> <li>version control of the Peppol repository.</li> <li>subscribing to one specific country (cf sparse checkout )</li> </ul>"},{"location":"#core-technology","title":"Core Technology","text":"<ul> <li>peppol_sync.py</li> <li>Python 3.x with <code>lxml</code> for XML processing</li> <li>GitHub Actions for daily automated sync</li> <li>Project Documentation : MkDocs with Material theme (using pforret/mkdox )</li> </ul>"},{"location":"#sparse-checkout","title":"Sparse Checkout","text":"<p>You can 'subscribe' to only the .xml files for 1 specific country (so not the full 2+GB of extract files) , using git sparse-checkout.</p> <p> github.com/peppoller/peppol_per_country</p>"},{"location":"documentation/","title":"mkdox documentation","text":"<p>Uses MkDocs with Material theme. Configuration in <code>mkdocs.yml</code>:</p> <ul> <li>Main docs in <code>docs/</code> directory</li> <li>Publish to <code>site/</code> directory</li> <li>Documentation is deployed to GitHub Pages via the static workflow</li> <li><code>README.md</code> is a symlink to <code>docs/index.md</code></li> </ul> <p>Published to peppoller.github.io/peppol_per_country</p>"},{"location":"github/","title":"GitHub action","text":""},{"location":"github/#daily-sync-workflow","title":"Daily Sync Workflow","text":"<ul> <li>via <code>.github/workflows/daily.yml</code></li> <li>Runs at 00:15 UTC daily (cron: \"15 0 * * *\")</li> <li>Executes <code>python3 peppol_sync.py sync</code></li> <li>Requires <code>contents: write</code> permission for GITHUB_TOKEN</li> <li>Commits and pushes changes to <code>extracts/</code>, <code>docs/</code>, and <code>log/</code> directories</li> <li>Creates <code>log/git_status.txt</code> with git status summary</li> <li>Creates <code>log/git_diff.txt</code> with detailed change statistics</li> <li>Commit message includes timestamp and version from <code>VERSION.md</code></li> <li>Logs total execution time at the end of the workflow</li> <li>Takes approximately 5 minutes</li> </ul>"},{"location":"github/#pages-deployment","title":"Pages Deployment","text":"<ul> <li>via <code>.github/workflows/static.yml</code></li> <li>Deploys <code>site/</code> directory to GitHub Pages</li> <li>Triggered on push to main branch when <code>site/**</code> files change</li> <li>Uses sparse checkout to only fetch the <code>site/</code> directory (optimizes checkout performance)</li> <li>Requires <code>contents: read</code>, <code>pages: write</code>, and <code>id-token: write</code> permissions</li> </ul> <pre><code>      - name: \"Checkout (sparse: site/)\"\n        uses: actions/checkout@v4\n        with:\n          fetch-depth: 1\n          filter: 'blob:none'\n          sparse-checkout: |\n            site\n          sparse-checkout-cone-mode: true\n</code></pre>"},{"location":"github/#github-action-testing","title":"GitHub action testing","text":"<pre><code># uses https://github.com/nektos/act\n# on MacOS: brew install act\n\ntest_gh_action.sh\n</code></pre>"},{"location":"peppol_sync/","title":"peppol_sync.py","text":""},{"location":"peppol_sync/#overview","title":"Overview","text":"<p>The <code>peppol_sync.py</code> script is a command-line tool designed to synchronize business card data from the PEPPOL directory. It downloads a large XML file, splits it into smaller, more manageable XML files organized by country, and stores them in the <code>extracts/</code> directory.</p>"},{"location":"peppol_sync/#command-line-usage","title":"Command-line Usage","text":"<pre><code>usage: peppol_sync.py [-h] [-V] [-F] [-C] [-K] [-T TMP] [-M MAX] {sync,check,download,huge}\n\nSynchronize PEPPOL export into git-managed files\n\npositional arguments:\n  {sync,check,download,huge}\n                        Action to perform\n\noptions:\n  -h, --help            show this help message and exit\n  -V, --verbose         Enable verbose output\n  -F, --force           Force re-download of XML file even if it exists\n  -C, --nocleanup       Do not delete existing XML files in extracts/ before starting (default: delete)\n  -K, --keep-tmp        Keep temporary files after processing (default: delete)\n  -T, --tmp TMP         Temporary directory (default: tmp)\n  -M, --max MAX         Maximum number of bytes per output file (default: 1000000)\n</code></pre>"},{"location":"peppol_sync/#actions","title":"Actions","text":"<p>The first argument to the script must be one of the following actions:</p> <ul> <li><code>sync</code>: This is the main action. It performs the entire synchronization process, which includes downloading the XML file (if necessary) and splitting it into country-specific files.</li> <li><code>check</code>: This action checks the configuration and prints the temporary and extracts directories.</li> <li><code>download</code>: This action only downloads the PEPPOL business card XML file and saves it to the temporary directory.</li> <li><code>huge</code>: This action lists the largest XML files found in the <code>extracts/</code> directory.</li> </ul>"},{"location":"peppol_sync/#options","title":"Options","text":"<ul> <li><code>-h</code>, <code>--help</code>: Shows the help message and exits.</li> <li><code>-V</code>, <code>--verbose</code>: Enables verbose output, providing more detailed information about the script's execution.</li> <li><code>-F</code>, <code>--force</code>: Forces the script to re-download the main XML file, even if a local copy already exists.</li> <li><code>-C</code>, <code>--nocleanup</code>: By default, the script deletes all existing XML files in the <code>extracts/</code> directory before starting a new sync. This flag prevents the cleanup, preserving the existing files.</li> <li><code>-K</code>, <code>--keep-tmp</code>: Prevents the script from deleting temporary files (like the downloaded XML) after processing is complete.</li> <li><code>-T</code>, <code>--tmp TMP</code>: Specifies the temporary directory to use for downloading files. Defaults to <code>tmp</code>.</li> <li><code>-M</code>, <code>--max MAX</code>: Sets the maximum size in bytes for each output XML file. When a file exceeds this size, a new one is created. Defaults to 2000000 (2MB).</li> </ul>"},{"location":"peppol_sync/#functionality","title":"Functionality","text":"<p>The <code>PeppolSync</code> class handles the entire workflow:</p> <ol> <li> <p>Download Phase (<code>download_xml()</code> at line 70)</p> <ul> <li>Streams XML from <code>https://directory.peppol.eu/export/businesscards</code></li> <li>Saves to <code>tmp/directory-export-business-cards.xml</code></li> <li>Shows progress every 100MB</li> <li>Skips download if file exists (override with <code>-F</code>)</li> </ul> </li> <li> <p>Processing Phase (<code>process_xml()</code> at line 153)</p> <ul> <li>Uses text-based chunking (1MB chunks) for memory efficiency</li> <li>Parses business cards with <code>lxml.etree</code> for fast XML handling</li> <li>Extracts country code from <code>&lt;entity countrycode=\"XX\"&gt;</code></li> <li>Extracts registration date from <code>&lt;regdate&gt;</code> for statistics</li> <li>Writes pretty-printed XML to country directories</li> </ul> </li> <li> <p>File Splitting Logic (lines 228-250)</p> <ul> <li>Splits files when they exceed <code>max_bytes</code> (default: 2MB)</li> <li>Sequential naming: <code>business-cards.000001.xml</code>, <code>business-cards.000002.xml</code>, etc.</li> <li>Each country has its own directory: <code>extracts/BE/</code>, <code>extracts/NO/</code>, etc.</li> <li>Automatically creates header and footer tags for valid XML</li> </ul> </li> <li> <p>Report Generation (<code>generate_report()</code> at line 269)</p> <ul> <li>Creates <code>extracts/report.md</code> with country statistics</li> <li>Shows file count, card count, and size per country</li> </ul> </li> </ol>"},{"location":"peppol_sync/#running-the-sync-tool","title":"Running the sync tool","text":"<pre><code># Full sync: download + process XML (recommended for first run)\npython3 peppol_sync.py sync\n\n# Force re-download even if file exists\npython3 peppol_sync.py sync -F\n\n# Keep temporary files for debugging\npython3 peppol_sync.py sync -K\n\n# Don't delete existing extracts before processing\npython3 peppol_sync.py sync -C\n\n# Verbose output\npython3 peppol_sync.py sync -V\n</code></pre>"},{"location":"peppol_sync/#utility-commands","title":"Utility commands","text":"<pre><code># Download XML only (no processing)\npython3 peppol_sync.py download\n\n# Check configuration\npython3 peppol_sync.py check\n\n# Show largest output files\npython3 peppol_sync.py huge -n 20\n\n# Custom max file size (default: 2MB)\npython3 peppol_sync.py sync -M 1000000\n</code></pre>"},{"location":"peppol_sync/#dependencies","title":"Dependencies","text":"<pre><code># Install required Python package\npip install lxml\n</code></pre>"},{"location":"peppol_sync/#key-implementation-details","title":"Key Implementation Details","text":""},{"location":"peppol_sync/#memory-efficient-xml-processing","title":"Memory-Efficient XML Processing","text":"<p>The script processes multi-GB XML files without loading everything into memory:</p> <ul> <li>Reads in 1MB text chunks</li> <li>Splits on <code>&lt;/businesscard&gt;</code> delimiter</li> <li>Parses individual cards with lxml</li> <li>Uses streaming writes to output files</li> </ul>"},{"location":"peppol_sync/#country-code-extraction","title":"Country Code Extraction","text":"<p>Located in <code>extract_country_from_etree()</code> (line 130): <pre><code>entity = element.find(\".//entity\")\nif entity is not None:\n    return entity.get(\"countrycode\")\n</code></pre></p>"},{"location":"peppol_sync/#file-rotation","title":"File Rotation","text":"<p>When a country file exceeds <code>max_bytes</code>:</p> <ol> <li>Writes <code>&lt;/root&gt;</code> footer to close current file</li> <li>Increments sequence number in <code>self.file_stats[country]['sequence']</code></li> <li>Opens new file with updated sequence</li> <li>Writes XML header to new file</li> </ol>"},{"location":"peppol_sync/#cleanup-behavior","title":"Cleanup Behavior","text":"<ul> <li>Temporary files (<code>tmp/</code>): Deleted after processing by default (keep with <code>-K</code>)</li> <li>Extract files (<code>extracts/**/*.xml</code>): Deleted before each sync by default (preserve with <code>-C</code>)</li> <li>Log file (<code>extracts/peppol_sync.log</code>): Overwritten on each run</li> </ul>"},{"location":"report/","title":"PEPPOL Sync Report","text":"<p>Generated on: 2025-11-12 02:15:47</p> Country Files Cards Size (MB) 00 1 5 0.00 AD 1 7 0.01 AE 1 52 0.05 AF 1 9 0.01 AI 1 2 0.00 AL 1 6 0.01 AO 1 1 0.00 AR 1 1 0.00 AT 1 362 0.54 AU 167 425882 318.19 AW 1 1 0.00 AX 1 6 0.01 BA 1 3 0.00 BE 625 879187 1190.93 BG 1 46 0.06 BH 1 1 0.00 BR 1 10 0.01 BV 1 1 0.00 BZ 1 5 0.01 CA 1 60 0.06 CD 1 1 0.00 CH 1 203 0.29 CL 1 1 0.00 CN 1 178 0.17 CO 1 1 0.00 CY 1 22 0.04 CZ 1 94 0.10 DE 10 8612 18.66 DK 58 64571 109.57 DZ 1 1 0.00 EC 1 1 0.00 EE 5 11159 9.01 EG 1 5 0.00 ES 5 6001 9.39 FI 6 11980 9.54 FO 1 2 0.00 FR 128 125968 244.12 GB 6 17291 9.72 GE 1 1 0.00 GI 1 1 0.00 GL 1 7 0.01 GP 1 4 0.01 GR 1 60 0.06 HK 1 82 0.10 HR 1 61 0.09 HU 1 52 0.06 ID 1 13 0.01 IE 1 251 0.31 IL 1 15 0.01 IN 1 65 0.07 IO 1 1 0.00 IS 7 8498 12.55 IT 16 21461 29.98 JO 1 1 0.00 JP 4 9228 6.55 KH 1 3 0.00 KR 1 16 0.02 KZ 1 3 0.00 LI 1 1 0.00 LK 1 2 0.00 LT 4 5429 5.94 LU 3 2683 5.17 LV 1 218 0.23 MA 1 3 0.01 MC 1 1 0.00 MD 1 1 0.00 MH 1 10 0.01 MK 1 1 0.00 MM 1 2 0.00 MN 1 2 0.00 MO 1 1 0.00 MQ 1 3 0.01 MT 1 304 0.26 MX 1 6 0.01 MY 12 12028 21.94 NG 1 1 0.00 NL 60 76546 113.30 NO 194 352172 369.40 NP 1 1 0.00 NZ 22 53913 40.38 OM 1 2 0.00 PH 1 14 0.02 PL 33 20516 62.29 PT 1 102 0.18 QA 1 1 0.00 RE 1 3 0.01 RO 1 102 0.16 RS 1 5 0.01 RU 1 1 0.00 SA 1 8 0.01 SC 1 4 0.01 SE 60 144816 114.18 SG 59 63269 112.01 SI 1 59 0.47 SK 1 32 0.04 SM 1 1 0.00 SN 1 1 0.00 SR 1 1 0.00 TH 1 23 0.02 TR 1 25 0.04 TW 1 15 0.01 UA 1 3 0.00 UK 1 4 0.01 US 1 352 0.34 VG 1 11 0.02 VI 1 1 0.00 VN 1 15 0.02 XX 1 1 0.00 ZA 1 12 0.01 ZZ 1 3 0.03 Total 1573 2324291 2816.91"},{"location":"sparse/","title":"Git Sparse Checkout","text":"<p>If you are only interested in the data for a specific country, you can use Git's <code>sparse-checkout</code> feature to download only the files for that country. This can save a significant amount of disk space and time.</p> <p>Here is how you can do a sparse checkout for just the data for Norway (<code>NO</code>).</p>"},{"location":"sparse/#step-by-step-guide","title":"Step-by-step guide","text":"<ol> <li> <p>Clone the repository without checking out any files:</p> <p>This special clone command creates the <code>.git</code> directory with all the repository history but doesn't pull the actual files yet.</p> <pre><code>git clone --filter=blob:none --no-checkout https://github.com/peppoller/peppol_per_country.git\ncd peppol_per_country\n</code></pre> </li> <li> <p>Enable sparse checkout and define the directory you want:</p> <p>This command tells Git that you only want to have the files in the <code>extracts/NO/</code> directory.</p> <pre><code>git sparse-checkout set extracts/NO/\n</code></pre> </li> <li> <p>Pull the files:</p> <p>Now, Git will pull only the files that match the path you specified.</p> <pre><code>git checkout\n</code></pre> </li> </ol> <p>After these steps, your <code>extracts/</code> directory will contain only the <code>NO</code> subdirectory.</p>"},{"location":"sparse/#adding-more-directories","title":"Adding more directories","text":"<p>If you want to add more directories later, you can use the <code>add</code> command:</p> <pre><code>git sparse-checkout add extracts/SE/\ngit checkout\n</code></pre>"},{"location":"sparse/#reverting-to-a-full-checkout","title":"Reverting to a full checkout","text":"<p>If you want to disable sparse checkout and download all the files in the repository, you can use the <code>disable</code> command:</p> <pre><code>git sparse-checkout disable\ngit checkout\n</code></pre>"}]}